#!/bin/bash -e
# shellcheck disable=2016

__get_temps(){
    git log --pretty=format:'%s' --grep='^temp' |
    wc -w |
    tr -d '[:space:]'
}

__saved_branch(){
    local BRANCH
    BRANCH=$(<.branch)
    echo "${BRANCH:-master}"
    rm -rf .branch
}

GIT_COMMANDS=(
    'fetch -v'
    'checkout temp'
    'pull origin temp'
    'reset --hard origin/temp'
    'reset --soft HEAD~$(__get_temps)'
    'reset'
    'checkout $(__saved_branch)'
    'push --delete origin temp'
    'branch -D temp'
)

IFS=$'\n'
for COMMAND in ${GIT_COMMANDS[*]}; do
    eval "git $COMMAND"
done
